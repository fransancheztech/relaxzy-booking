generator client {
  provider        = "prisma-client-js"
  output          = "../generated/prisma"
  previewFeatures = ["views"]
}

datasource db {
  provider = "postgresql"
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model bookings {
  id         String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  client_id  String?        @db.Uuid
  service_id String?        @db.Uuid
  start_time DateTime?      @db.Timestamptz(6)
  end_time   DateTime?      @db.Timestamptz(6)
  notes      String?
  status     booking_status @default(confirmed)
  created_at DateTime       @default(dbgenerated("(now() AT TIME ZONE 'utc'::text)")) @db.Timestamptz(6)
  updated_at DateTime       @default(dbgenerated("(now() AT TIME ZONE 'utc'::text)")) @db.Timestamptz(6)
  deleted_at DateTime?      @db.Timestamptz(6)
  price      Decimal?       @db.Decimal
  clients    clients?       @relation(fields: [client_id], references: [id], onUpdate: NoAction)
  services   services?      @relation(fields: [service_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  payments   payments[]

  @@unique([client_id, service_id, start_time], map: "bookings_client_service_start_unique")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model bookings_history {
  id          String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  client_id   String?        @db.Uuid
  start_time  DateTime?      @db.Timestamptz(6)
  end_time    DateTime?      @db.Timestamptz(6)
  service_id  String?        @db.Uuid
  notes       String?
  status      booking_status
  created_at  DateTime       @db.Timestamptz(6)
  updated_at  DateTime       @default(dbgenerated("(now() AT TIME ZONE 'utc'::text)")) @db.Timestamptz(6)
  change_type change_type
  booking_id  String?        @db.Uuid
  price       Decimal?       @db.Decimal
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model clients {
  id             String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  client_name    String?    @default("Unknown")
  client_email   String?
  client_phone   String?
  client_notes   String?
  created_at     DateTime   @default(dbgenerated("(now() AT TIME ZONE 'utc'::text)")) @db.Timestamptz(6)
  updated_at     DateTime?  @db.Timestamptz(6)
  client_surname String?
  deleted_at     DateTime?  @db.Timestamptz(6)
  bookings       bookings[]

  @@index([client_email(ops: raw("gin_trgm_ops"))], map: "clients_email_idx", type: Gin)
  @@index([client_name(ops: raw("gin_trgm_ops"))], map: "clients_full_name_idx", type: Gin)
  @@index([client_phone(ops: raw("gin_trgm_ops"))], map: "clients_phone_idx", type: Gin)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model payments {
  id          String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  booking_id  String?          @db.Uuid
  amount      Decimal          @db.Decimal(10, 2)
  method      payment_methods?
  refunded    Decimal?         @default(0) @db.Decimal
  paid_at     DateTime?        @db.Timestamptz(6)
  paid        Boolean          @default(false)
  refunded_at DateTime?        @db.Timestamptz(6)
  client_id   String?          @db.Uuid
  deleted_at  DateTime?        @db.Timestamptz(6)
  bookings    bookings?        @relation(fields: [booking_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([booking_id, method], map: "payments_booking_method_unique")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model payments_log {
  id           String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  payment_id   String?     @db.Uuid
  change_type  change_type
  old_data     Json?
  new_data     Json?
  performed_at DateTime    @default(dbgenerated("(now() AT TIME ZONE 'utc'::text)")) @db.Timestamptz(6)
  performed_by String?     @db.Uuid
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model services {
  id                       String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                     String
  created_at               DateTime?  @default(now()) @db.Timestamp(6)
  standard_duration_prices Json?
  duration                 Decimal?   @db.Decimal
  price                    Decimal?   @db.Decimal
  notes                    String?
  short_name               String?
  deleted_at               DateTime?  @db.Timestamptz(6)
  bookings                 bookings[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model therapists {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  full_name  String
  email      String?
  phone      String?
  notes      String?
  created_at DateTime  @default(dbgenerated("(now() AT TIME ZONE 'utc'::text)")) @db.Timestamptz(6)
  active     Boolean   @default(false)
  deleted_at DateTime? @db.Timestamptz(6)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model clients_history {
  id             String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  client_id      String?     @db.Uuid
  client_name    String?
  client_surname String?
  client_email   String?
  client_phone   String?
  client_notes   String?
  created_at     DateTime    @db.Timestamptz(6)
  updated_at     DateTime?   @db.Timestamptz(6)
  deleted_at     DateTime?   @db.Timestamptz(6)
  change_type    change_type
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model services_history {
  id                       String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  service_id               String?     @db.Uuid
  name                     String
  short_name               String?
  standard_duration_prices Json?
  duration                 Decimal?    @db.Decimal
  price                    Decimal?    @db.Decimal
  notes                    String?
  created_at               DateTime?   @db.Timestamp(6)
  deleted_at               DateTime?   @db.Timestamptz(6)
  change_type              change_type
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model therapists_history {
  id           String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  therapist_id String?     @db.Uuid
  full_name    String
  email        String?
  phone        String?
  notes        String?
  active       Boolean
  created_at   DateTime    @db.Timestamptz(6)
  deleted_at   DateTime?   @db.Timestamptz(6)
  change_type  change_type
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model services_details {
  id                  String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  service_name_id     String             @db.Uuid
  service_duration_id String             @db.Uuid
  price               Decimal            @db.Decimal
  created_at          DateTime?          @default(now()) @db.Timestamptz(6)
  deleted_at          DateTime?          @db.Timestamptz(6)
  notes               String?
  services_durations  services_durations @relation(fields: [service_duration_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  services_names      services_names     @relation(fields: [service_name_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([service_name_id, service_duration_id])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model services_details_history {
  id                  String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  service_details_id  String?      @db.Uuid
  service_name_id     String?      @db.Uuid
  service_duration_id String?      @db.Uuid
  price               Decimal?     @db.Decimal
  notes               String?
  created_at          DateTime?    @db.Timestamptz(6)
  deleted_at          DateTime?    @db.Timestamptz(6)
  change_type         change_type?
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model services_durations {
  id               String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  duration         Decimal            @unique @db.Decimal
  notes            String?
  created_at       DateTime?          @default(now()) @db.Timestamptz(6)
  deleted_at       DateTime?          @db.Timestamptz(6)
  services_details services_details[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model services_durations_history {
  id                  String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  service_duration_id String?      @db.Uuid
  duration            Decimal?     @db.Decimal
  notes               String?
  created_at          DateTime?    @db.Timestamptz(6)
  deleted_at          DateTime?    @db.Timestamptz(6)
  change_type         change_type?
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model services_names {
  id               String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name             String             @unique
  short_name       String?
  notes            String?
  created_at       DateTime?          @db.Timestamptz(6)
  deleted_at       DateTime?          @db.Timestamptz(6)
  services_details services_details[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model services_names_history {
  id              String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  service_name_id String?      @db.Uuid
  name            String?
  short_name      String?
  notes           String?
  created_at      DateTime?    @db.Timestamptz(6)
  deleted_at      DateTime?    @db.Timestamptz(6)
  change_type     change_type?
}

view bookings_with_details {
  booking_id         String?          @db.Uuid
  booking_start_time DateTime?        @db.Timestamptz(6)
  booking_end_time   DateTime?        @db.Timestamptz(6)
  booking_notes      String?
  booking_status     booking_status?
  booking_created_at DateTime?        @db.Timestamptz(6)
  booking_updated_at DateTime?        @db.Timestamptz(6)
  client_id          String?          @db.Uuid
  client_name        String?
  client_email       String?
  client_phone       String?
  client_notes       String?
  client_created_at  DateTime?        @db.Timestamptz(6)
  service_id         String?          @db.Uuid
  service_name       String?
  service_created_at DateTime?        @db.Timestamp(6)
  payment_id         String?          @db.Uuid
  payment_amount     Decimal?         @db.Decimal(10, 2)
  payment_method     payment_methods?
  payment_refunded   Decimal?         @db.Decimal
  payment_paid_at    DateTime?        @db.Timestamptz(6)
  booking_price      Decimal?         @db.Decimal
}

enum booking_status {
  confirmed
  cancelled
  completed
}

enum change_type {
  INSERT
  UPDATE
  DELETE
}

enum payment_methods {
  cash
  credit_card @map("credit card")
}
